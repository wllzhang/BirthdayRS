name: Daily Birthday Check Dev

on:
  workflow_dispatch:

env:
  TZ: Asia/Shanghai  # è®¾ç½®ä¸ºåŒ—äº¬æ—¶é—´
  REGISTRY: ghcr.io

jobs:
  check-birthdays-dev:
    name: ğŸ” Devç¯å¢ƒ - æ£€æŸ¥ç”Ÿæ—¥
    environment: Dev
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ åˆ›å»ºæµ‹è¯•é…ç½®æ–‡ä»¶
        run: |
          mkdir -p config
          cat > config/config.yml << 'EOF'
          ${{ vars.BIRTHDAY_YAML }}
          EOF
          echo "    solar_birthday: $(date '+%Y-%m-%d')" >> config/config.yml

      - name: ğŸ³ æ‹‰å–å¹¶è¿è¡Œ Docker é•œåƒ
        run: |
          IMAGE_NAME="${{ env.REGISTRY }}/$(echo '${{ github.repository }}' | tr '[:upper:]' '[:lower:]'):latest"
          docker run --rm \
            -v $PWD/config/config.yml:/app/config.yml \
            -e TZ=Asia/Shanghai \
            $IMAGE_NAME \
            run --config /app/config.yml
