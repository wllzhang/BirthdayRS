name: Birthday Check Action
description: å®‰è£…ä¾èµ–ã€å†™é…ç½®ã€è¿è¡Œç”Ÿæ—¥æ£€æŸ¥é€»è¾‘

inputs:
  config_filename:
    description: è¦ç”Ÿæˆçš„é…ç½®æ–‡ä»¶å
    required: false
    default: config.yml

  debug:
    description: æ˜¯å¦å¼€å¯è°ƒè¯•æ¨¡å¼ï¼Œæ˜¾ç¤ºå®Œæ•´é…ç½®å†…å®¹
    required: false
    default: "false"

runs:
  using: "composite"
  steps:
    - name: ğŸ“¦ å®‰è£…ä¾èµ–
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
      shell: bash

    - name: ğŸ› ï¸ å¦‚æœé…ç½®æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»º
      run: |
        if [[ ! -f "${{ inputs.config_filename }}" ]]; then
          echo "ğŸ“¥ æ–‡ä»¶ä¸å­˜åœ¨ï¼Œæ­£åœ¨å†™å…¥é…ç½®..."

          # è·å–å½“å‰æ—¥æœŸ
          current_date=$(date '+%Y-%m-%d')

          # å¦‚æœæ˜¯è°ƒè¯•æ¨¡å¼ï¼Œå†™å…¥æµ‹è¯•ç”¨æˆ·çš„å†…å®¹
          if [[ "${{ inputs.debug }}" == "true" ]]; then
            BIRTHDAY_YAML=$(cat <<EOF
recipients:
  - name: "æµ‹è¯•ç”¨æˆ·"
    solar_birthday: "$current_date"  # ä½¿ç”¨å½“å‰æ—¥æœŸ
EOF
            )
          fi
          # å°†ç”Ÿæˆçš„ YAML å†…å®¹å†™å…¥é…ç½®æ–‡ä»¶
          echo "$BIRTHDAY_YAML" > "${{ inputs.config_filename }}"
          echo "âœ… é…ç½®æ–‡ä»¶å·²åˆ›å»ºå¹¶æ›´æ–°ã€‚"
        else
          echo "âœ… é…ç½®æ–‡ä»¶å·²å­˜åœ¨ï¼Œè·³è¿‡å†™å…¥ã€‚"
        fi
      shell: bash

    - name: ğŸ•“ æ˜¾ç¤ºå½“å‰æ—¶é—´
      run: date
      shell: bash

    - name: ğŸ“„ æ˜¾ç¤ºé…ç½®å†…å®¹
      run: |
        echo "ğŸ¯ é…ç½®æ–‡ä»¶ï¼š${{ inputs.config_filename }}"
        if [[ "${{ inputs.debug }}" == "true" ]]; then
          echo "ğŸ“œ å…¨éƒ¨å†…å®¹ï¼š"
          cat "${{ inputs.config_filename }}"
        else
          echo "ğŸ“œ å‰ 10 è¡Œï¼š"
          head -n 10 "${{ inputs.config_filename }}"
        fi
      shell: bash

    - name: ğŸ‰ æ‰§è¡Œç”Ÿæ—¥æ£€æŸ¥
      run: python -m src.main run
      shell: bash
